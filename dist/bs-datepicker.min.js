(function($){$.bsDatepicker={default:{locale:"de-DE",range:false,inline:false,startOnSunday:false,autoClose:true,format:"locale",separator:" – ",zIndex:1080,months:1,icons:{prev:"bi bi-chevron-left",next:"bi bi-chevron-right",clear:"bi bi-x-lg"}}};const NS="bs.datepicker";function startOfDay(d){const x=new Date(d.getTime());x.setHours(0,0,0,0);return x}function isSameDay(a,b){if(!a||!b)return false;return a.getFullYear()===b.getFullYear()&&a.getMonth()===b.getMonth()&&a.getDate()===b.getDate()}function addMonths(date,n){const d=new Date(date.getFullYear(),date.getMonth()+n,1);return d}function daysInMonth(year,month){return new Date(year,month+1,0).getDate()}function clampRange(a,b){if(!a||!b)return[a,b];return a<=b?[a,b]:[b,a]}function inRange(d,a,b){if(!a||!b)return false;const[s,e]=clampRange(a,b);return d>=startOfDay(s)&&d<=startOfDay(e)}function getWeekdayNames(locale,startOnSunday){const fmt=new Intl.DateTimeFormat(locale,{weekday:"short"});const base=new Date(2021,7,1);const days=[];for(let i=0;i<7;i++){const d=new Date(base.getFullYear(),base.getMonth(),base.getDate()+i);days.push(fmt.format(d))}if(startOnSunday)return days;return days.slice(1).concat(days.slice(0,1))}function getMonthYearTitle(date,locale){const fmt=new Intl.DateTimeFormat(locale,{month:"long",year:"numeric"});return fmt.format(date)}function formatDateValue(value,opts){const{format,locale,separator}=opts;if(typeof format==="function")return format(value);const fmt=new Intl.DateTimeFormat(locale,{year:"numeric",month:"2-digit",day:"2-digit"});if(Array.isArray(value)){const[a,b]=value;if(!a&&!b)return"";if(format==="iso"){const toISO=d=>d?d.toISOString().slice(0,10):"";return[toISO(a),toISO(b)].filter(Boolean).join(separator)}return[a?fmt.format(a):"",b?fmt.format(b):""].filter(Boolean).join(separator)}else if(value instanceof Date){if(format==="iso")return value.toISOString().slice(0,10);return fmt.format(value)}return""}function buildCalendarGrid(current,opts){const year=current.getFullYear();const month=current.getMonth();const firstOfMonth=new Date(year,month,1);const firstWeekday=firstOfMonth.getDay();const shift=opts.startOnSunday?0:1;const startIdx=(firstWeekday-shift+7)%7;const dim=daysInMonth(year,month);const prevDim=daysInMonth(year,month-1<0?11:month-1);const cells=[];for(let i=0;i<42;i++){const cell={inMonth:false,date:null};if(i<startIdx){const day=prevDim-(startIdx-1-i);const d=new Date(year,month,1);d.setDate(d.getDate()-(startIdx-i));cell.inMonth=false;cell.date=startOfDay(d)}else if(i>=startIdx&&i<startIdx+dim){const day=i-startIdx+1;cell.inMonth=true;cell.date=startOfDay(new Date(year,month,day))}else{const d=new Date(year,month,dim);d.setDate(d.getDate()+(i-(startIdx+dim))+1);cell.inMonth=false;cell.date=startOfDay(d)}cells.push(cell)}return cells}function renderOneMonthBlock(currMonthDate,state){const{opts,selected,rangeStart}=state;const weekdays=getWeekdayNames(opts.locale,opts.startOnSunday);const title=getMonthYearTitle(currMonthDate,opts.locale);const cells=buildCalendarGrid(currMonthDate,opts);const today=startOfDay(new Date);const isRange=!!opts.range;let html="";html+='<div class="mb-2">';html+='  <div class="fw-semibold text-capitalize text-center mb-0">'+title+"</div>";html+='  <div class="table-responsive">';html+='    <table class="table table-sm table-borderless mb-0 text-center align-middle user-select-none w-auto">';html+="      <thead><tr>";weekdays.forEach(w=>{html+='<th class="text-muted small">'+w+"</th>"});html+="      </tr></thead>";html+="      <tbody>";const year=currMonthDate.getFullYear();const month=currMonthDate.getMonth();const firstOfMonth=new Date(year,month,1);const firstWeekday=firstOfMonth.getDay();const shift=opts.startOnSunday?0:1;const startIdx=(firstWeekday-shift+7)%7;const dim=daysInMonth(year,month);const neededCells=startIdx+dim;const rows=Math.ceil(neededCells/7);for(let r=0;r<rows;r++){html+="<tr>";for(let c=0;c<7;c++){const idx=r*7+c;const dayIndex=idx-startIdx;const d=startOfDay(new Date(year,month,dayIndex+1));const inMonth=dayIndex>=0&&dayIndex<dim;const isToday=isSameDay(d,today);const isSelected=!isRange&&selected&&isSameDay(d,selected);const isStart=isRange&&rangeStart&&isSameDay(d,rangeStart);const isEnd=isRange&&selected&&!isStart&&isSameDay(d,selected);const isBetween=isRange&&rangeStart&&selected&&inRange(d,rangeStart,selected)&&!isStart&&!isEnd;const muted=!inMonth;let tdCls="p-0";let btnCls="btn btn-sm w-100 border-0 rounded-0 ";const inRangeAny=isStart||isEnd||isBetween;if(isSelected||inRangeAny)btnCls+="btn-primary ";else btnCls+=" ";if(muted)btnCls+=" text-muted ";if(isToday&&!(isSelected||inRangeAny))btnCls+=" text-danger fw-semibold ";if(isStart)btnCls+=" rounded-0 ";if(isEnd)btnCls+=" rounded-0 ";html+='<td class="'+tdCls.trim()+'">';html+='<button type="button" class="'+btnCls.trim()+'" data-action="pick" data-date="'+d.toISOString()+'">';html+=d.getDate();html+="</button>";html+="</td>"}html+="</tr>"}html+="      </tbody>";html+="    </table>";html+="  </div>";html+="</div>";return html}function renderTemplate(state){const{opts,current}=state;const months=Math.max(1,parseInt(opts.months||1,10));let html="";html+='<div class="card shadow">';html+='  <div class="card-header py-1 d-flex justify-content-between align-items-center">';html+='    <div class="btn-group">';html+='      <button type="button" class="btn btn-sm btn-light" data-action="prev"><i class="'+(opts.icons&&opts.icons.prev||$.bsDatepicker.default.icons.prev)+'"></i></button>';html+="    </div>";html+='    <div class="fw-semibold text-capitalize">'+getMonthYearTitle(current,opts.locale)+(months>1?" … "+getMonthYearTitle(addMonths(current,months-1),opts.locale):"")+"</div>";html+='    <div class="btn-group">';html+='      <button type="button" class="btn btn-sm btn-light" data-action="clear"><i class="'+(opts.icons&&opts.icons.clear||$.bsDatepicker.default.icons.clear)+'"></i></button>';html+='      <button type="button" class="btn btn-sm btn-light" data-action="next"><i class="'+(opts.icons&&opts.icons.next||$.bsDatepicker.default.icons.next)+'"></i></button>';html+="    </div>";html+="  </div>";html+='  <div class="card-body p-3">';html+='    <div class="row g-3">';for(let i=0;i<months;i++){html+='      <div class="col-auto">';html+=renderOneMonthBlock(addMonths(current,i),state);html+="      </div>";if(i%2===1&&i<months-1){html+='      <div class="w-100"></div>'}}html+="    </div>";html+="  </div>";html+="</div>";return html}function attachEvents(state){const{$panel,opts}=state;$panel.off("."+NS);$panel.on("click."+NS,'[data-action="prev"]',function(e){e.preventDefault();state.current=addMonths(state.current,-1);updatePanel(state)});$panel.on("click."+NS,'[data-action="next"]',function(e){e.preventDefault();state.current=addMonths(state.current,+1);updatePanel(state)});$panel.on("click."+NS,'[data-action="clear"]',function(e){e.preventDefault();state.rangeStart=null;state.selected=null;state.$input.val("").trigger("change");updatePanel(state)});$panel.on("click."+NS,'[data-action="pick"]',function(e){e.preventDefault();const iso=$(this).data("date");const d=startOfDay(new Date(iso));if(opts.range){const S=state.rangeStart;const E=state.selected;if(!S&&!E){state.rangeStart=d;state.selected=null;updatePanel(state)}else if(S&&!E){if(d<S){state.rangeStart=d;updatePanel(state)}else{state.selected=d;const[a,b]=clampRange(state.rangeStart,state.selected);const val=formatDateValue([a,b],opts);state.$input.val(val).trigger("change");updatePanel(state)}}else if(S&&E){if(d<=S){state.rangeStart=d}else if(d>=E){state.selected=d}else{const distToStart=d-S;const distToEnd=E-d;if(distToStart<=distToEnd){state.rangeStart=d}else{state.selected=d}}const[a,b]=clampRange(state.rangeStart,state.selected);state.$input.val(formatDateValue([a,b],opts)).trigger("change");updatePanel(state)}}else{state.selected=d;const val=formatDateValue(d,opts);state.$input.val(val).trigger("change");if(!opts.inline&&opts.autoClose)hideDropdown(state);updatePanel(state)}})}function updatePanel(state){const html=renderTemplate(state);state.$panel.html(html);attachEvents(state);if(!state.opts.inline&&state.$container&&state.$container.is(":visible")){applyCalculatedWidth(state)}}function showDropdown(state){if(state.opts.inline)return;const $input=state.$input;const off=$input.offset();const h=$input.outerHeight();state.$container.css({position:"absolute",top:off.top+h+4,left:off.left,zIndex:state.opts.zIndex,width:"auto"}).addClass("show").show();applyCalculatedWidth(state);$(document).on("mousedown."+NS,function(ev){const $t=$(ev.target);if($t.closest(state.$container).length===0&&$t.closest(state.$input).length===0){hideDropdown(state)}})}function applyCalculatedWidth(state){const $card=state.$panel.children(".card");if($card.length===0)return;const $body=$card.children(".card-body");let bodyPaddingX=0;if($body.length){const bs=getComputedStyle($body[0]);bodyPaddingX=(parseFloat(bs.paddingLeft)||0)+(parseFloat(bs.paddingRight)||0)}const $wrap=$body.children().first();if($wrap.length===0)return;let $months=$wrap.children(".col-auto");if($months.length===0){$months=$wrap.children(".d-inline-block")}if($months.length===0)return;const m0=$months.eq(0).outerWidth(true);let monthsWidth=m0;if($months.length>=2){const m1=$months.eq(1).outerWidth(true);monthsWidth=m0+m1}const targetWidth=monthsWidth+bodyPaddingX;$card.css("width",Math.ceil(targetWidth+1)+"px");state.$container.css({width:Math.ceil(targetWidth+1)+"px"})}function hideDropdown(state){if(state.opts.inline)return;state.$container.removeClass("show").hide();if(state.$input&&state.$input.length){state.$input.trigger("blur")}state.suppressOpenUntil=Date.now()+150;$(document).off("mousedown."+NS)}function create(state){const{opts}=state;state.current=startOfDay(new Date);state.selected=null;state.rangeStart=null;if(opts.inline){state.$container=$('<div class="bs-datepicker inline"></div>').insertAfter(state.$input)}else{state.$container=$('<div class="bs-datepicker dropdown-menu p-0" style="display:none; --bs-dropdown-min-width:auto;"></div>').appendTo("body")}state.$panel=$("<div></div>").appendTo(state.$container);updatePanel(state);if(!opts.inline){state.$container.removeClass("show").hide()}if(!opts.inline){state.$input.on("click."+NS,function(ev){if(state.$container.is(":visible"))return;if(state.suppressOpenUntil&&Date.now()<state.suppressOpenUntil)return;showDropdown(state)})}}function destroy(state){hideDropdown(state);if(state.$container)state.$container.remove();state.$input.off("."+NS).removeData(NS);$(document).off("."+NS)}const methods={getDate(){const state=this.data(NS);if(!state)return null;if(state.opts.range){return[state.rangeStart,state.selected].filter(Boolean)}return state.selected},setDate(dateOrRange){const state=this.data(NS);if(!state)return this;if(Array.isArray(dateOrRange)){state.rangeStart=dateOrRange[0]?startOfDay(new Date(dateOrRange[0])):null;state.selected=dateOrRange[1]?startOfDay(new Date(dateOrRange[1])):null;const[a,b]=clampRange(state.rangeStart,state.selected);this.val(formatDateValue([a,b],state.opts))}else if(dateOrRange){state.selected=startOfDay(new Date(dateOrRange));this.val(formatDateValue(state.selected,state.opts))}else{state.selected=null;state.rangeStart=null;this.val("")}updatePanel(state);return this},destroy(){const state=this.data(NS);if(state)destroy(state);return this}};$.fn.bsDatepicker=function(optionsOrMethod){if(this.length===0)return this;if(this.length>1){return this.each(function(){$(this).bsDatepicker(optionsOrMethod)})}const $element=this;if(typeof optionsOrMethod==="string"){const method=optionsOrMethod;if(methods[method]){return methods[method].apply($element,Array.prototype.slice.call(arguments,1))}return $element}const opts=$.extend({},$.bsDatepicker.default,optionsOrMethod||{});const state={$input:$element,opts:opts,$container:null,$panel:null,current:null,selected:null,rangeStart:null,suppressOpenUntil:0};$element.data(NS,state);create(state);return $element}})(jQuery);